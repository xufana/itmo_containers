# Лабораторная работа 1

## Bad practices

** 1. Использование latest версии **

Делает билд нестабильным, потому что не понятно, как себя поведет "начинка" / выполняемый проект на разных версиях. Решение: указывать версию в явном виде

** 2. Большое количество слоёв ** 

Делая большое количество слоёв, мы раздуваем размер образа, а это влияет на производительность. Решение: похожие по логике команды (как тут, всё то, что apt-get) лучше объединять в один слой

** 3. Делать всё из под root **

Мы рискуем, запуская всё от пользователя с большим количеством прав. Решение: создать пользователя с ограниченным набором прав и запустить часть команд от него

** 4. Отсутствие Healthcheck **

Если что-то сломалось, можем не заметить, а потом не понять, что именно там сломалось. Peшение: добавить healthcheck

## Запуск
Создать файл `.env`, который содержит в себе такие переменные (+пример заполнения):
```
POSTGRES_USER=airflow
POSTGRES_PASSWORD=airflow
POSTGRES_DB=airflow
AIRFLOW_ADMIN_USER=airflow
AIRFLOW_ADMIN_PASSWORD=airflow
AIRFLOW_ADMIN_EMAIL=airflow@airflow.com
```

```
 docker-compose up --build
```


## Структура

1. Postgres-db
БД. 

2. airflow-init (в compose фалйе просто init)
Создаём БД для airflow и создаём юзера-админа в БД

3. airflow-webserver (в compose фалйе просто webserver)
Веб-сервер airflow

## Впоросы

### Можно ли ограничивать ресурсы (например, память или CPU) для сервисов в docker-compose.yml? Если нет, то почему, если да, то как?

Можно, для этого на этапе "deploy" можно прописать что-то такое:

```
deploy:
  resources:
    limits:
      memory: 60m
      cpus: '0.25'
```

### Как можно запустить только определенный сервис из docker-compose.yml, не запуская остальные?

Да, так:

```
docker-compose up webserver
```

Поднимется только сервис webserver из compose файла